import { TokenFormat, TokenType } from '../formatted-string/types';
import ParserState from './state';
import { consumeTree, createTree } from './tree';
import { ParserOptions } from './types';
import { isDelimiter, isCodeBlock } from './utils';

const aliases = {
    ':C': '☹️',
    ':c': '☹️',
    ':)': '🙂',
    ':-)': '🙂',
    '<3': '❤️',
    ':(|)': '🐵',
    ':(:)': '🐷',
    '(]:{': '👳',
    '</3': '💔',
    '~@~': '💩',
    ':D': '😀',
    ':-D': '😀',
    '^_^': '😁',
    '=D': '😄',
    ':-@': '😣',
    ':-S': '😖',
    'O:)': '😇',
    'O=)': '😇',
    'O:-)': '😇',
    '}:)': '😈',
    '}=)': '😈',
    '}:-)': '😈',
    ';)': '😉',
    ';-)': '😉',
    '=)': '🙂',
    '^^': '😊',
    'B-)': '😎',
    ':,': '😏',
    ':-,': '😏',
    ':|': '😐',
    '=|': '😐',
    ':-|': '😐',
    '-_-': '😑',
    'u_u': '😔',
    // ':/': '😕',
    '=/': '😕',
    ':-/': '😕',
    ':-\\': '😕',
    ':s': '😖',
    ':-s': '😖',
    ':*': '😗',
    ':-*': '😗',
    ';*': '😘',
    ';-*': '😘',
    '=*': '😚',
    ':p': '😛',
    ':P': '😛',
    ':-p': '😛',
    ':-P': '😛',
    '=p': '😛',
    '=P': '😛',
    ';p': '😜',
    ';P': '😜',
    ';-p': '😜',
    ';-P': '😜',
    ':(': '🙁',
    ':-(': '🙁',
    '=(': '🙁',
    '>:(': '😡',
    ':\'(': '😢',
    '=\'(': '😢',
    'T_T': '😭',
    ';_;': '😭',
    '>.<': '😣',
    '>_<': '😣',
    'D:': '😦',
    ':o': '😮',
    ':O': '😮',
    '=o': '😮',
    '=O': '😮',
    ':-O': '😮',
    ':-o': '😮',
    'o.o': '😮',
    'O.O': '😲',
    'x_x': '😵',
    'X(': '😵',
    'X-(': '😵',
    'X-o': '😵',
    'X-O': '😵',
    ':3': '😸',
    'o/': '🙋',
    '\\o': '🙋',
    '\\m/': '🤘',
    ':-$': '🤐',
    ':$': '🤐',
    '*-)': '😐',
    ':-I': '😠',
    ':I': '😠',
    '8oI': '😡',
    '8o|': '😡',
    '|-)': '😪',
    '(ch)': '😏',
    '(lo)': '😍',
    '(sr)': '😔',
    '|-(': '😴',
    '(y)': '👍',
    '(Y)': '👍',
    '(n)': '👎',
    '(N)': '👎',
    '(H)': '😎',
    '(hu)': '😬',
    '(tr)': '😒',
    '(md)': '😵',
    '(fr)': '😄',
    '(dt)': '😟',
    '(sc)': '😕',
    '(v)': '✌️',
    '(L)': '❤️',
    '(U)': '💔',
    '(K)': '💋',
    '(F)': '🌼',
    '(*)': '⭐',
    '(^)': '🎂',
    '(G)': '🎁',
    '(B)': '🍺',
    '(D)': '🍸',
    '(CC)': '🎂',
    '(pi)': '🍕',
    '(pl)': '🍴',
    '(ic)': '🍦',
    '($)': '💰',
    '(co)': '💻',
    '(so)': '⚽',
    '(te)': '🎾',
    '(nt)': '🎵',
    '(I)': '💡',
    '(E)': '✉️',
    '(Z)': '👦',
    '(X)': '👧',
    '(S)': '🌙',
    '(facepalm)': '🤦‍'
};

const lookup = createTree(Object.keys(aliases));

export default function parseTextEmoji(state: ParserState, options: ParserOptions): boolean {
    if (options.textEmoji && !isCodeBlock(state) && state.atWordBound()) {
        const { pos } = state;

        // Если нашли совпадение, то убедимся, что оно на границе слов
        if (consumeTree(state, lookup) && isDelimiter(state.peek())) {
            const value = state.substring(pos);
            state.push({
                type: TokenType.TextEmoji,
                format: TokenFormat.None,
                value,
                emoji: aliases[value] || value
            });
            return true;
        }

        state.pos = pos;
    }

    return false;
}
